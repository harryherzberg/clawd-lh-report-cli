#!/usr/bin/env node\n\nconst { program } = require('commander');\nconst lighthouse = require('lighthouse');\nconst puppeteer = require('puppeteer');\nconst fs = require('fs');\nconst path = require('path');\n\nprogram\n  .name('lh-report')\n  .description('Lighthouse audit CLI: JSON/HTML/PDF reports')\n  .argument('<url>')\n  .option('-f, --format <type>', 'json|html|pdf (default: json)', 'json')\n  .option('-l, --license <key>', 'Pro license for HTML/PDF')\n  .action(async (url, cmd) => {\n    const format = cmd.format.toLowerCase();\n    const license = cmd.license;\n\n    if (['html', 'pdf'].includes(format) && !license) {\n      console.error('Pro formats (html/pdf) require license: lh-report URL -f pdf -l YOUR_KEY');\n      process.exit(1);\n    }\n\n    const isValidLicense = license === 'DEMO-PRO' || (license && license.startsWith('pro-') && license.length > 10);\n\n    if (!isValidLicense) {\n      console.error('Invalid or missing license for pro format.');\n      process.exit(1);\n    }\n\n    console.log(`Auditing ${url}...`);\n\n    const flags = {\n      logLevel: 'info',\n      output: format === 'html' ? 'html' : 'json',\n      onlyCategories: ['performance', 'accessibility', 'best-practices', 'seo'],\n    };\n\n    const config = null; // default\n\n    const { lhr, report } = await lighthouse(url, flags, config);\n\n    const safeName = url.replace(/[^a-z0-9]/gi, '-').replace(/-+/g, '-') + `-lh-report`;\n    const ext = format === 'pdf' ? 'pdf' : format;\n    const filename = `${safeName}.${ext}`;\n\n    try {\n      if (format === 'json') {\n        fs.writeFileSync(filename, JSON.stringify(lhr, null, 2));\n        console.log(`JSON report saved: ${filename}`);\n      } else if (format === 'html') {\n        fs.writeFileSync(filename, report);\n        console.log(`HTML report saved: ${filename}`);\n      } else if (format === 'pdf') {\n        const browser = await puppeteer.launch({ headless: 'new' });\n        const page = await browser.newPage();\n        await page.setContent(report, { waitUntil: 'networkidle0' });\n        const pdf = await page.pdf({\n          format: 'A4',\n          printBackground: true,\n        });\n        await browser.close();\n        fs.writeFileSync(filename, pdf);\n        console.log(`PDF report saved: ${filename}`);\n      }\n    } catch (err) {\n      console.error('Error generating report:', err.message);\n    }\n  });\n\nprogram.parse();